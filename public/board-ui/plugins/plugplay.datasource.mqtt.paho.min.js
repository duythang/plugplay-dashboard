!function(){freeboard.loadDatasourcePlugin({type_name:"plugplay_mqtt_paho",display_name:"PlugPlay MQTT",description:"Receive data from an MQTT server.",external_scripts:["https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"],settings:[{name:"use_ssl",display_name:"Use SSL",type:"boolean",description:"Use SSL/TLS to connect to the MQTT Server",default_value:!0},{name:"user_key",display_name:"User Key",type:"text",required:!0},{name:"board_id",display_name:"Board Id",type:"text",required:!0},{name:"topic",display_name:"Topic to subscribe",type:"text",description:"The topic to subscribe to",required:!0}],newInstance:function(n,o,s){o(new e(n,s))}});var e=function(e,n){function o(){a.subscribe(i)}function s(e){0!==e.errorCode&&console.log("MQTT PlugPlay onConnectionLost: "+e.errorMessage)}function t(e){c.msg=JSON.parse(e.payloadString),n(c)}var a,i,r=this,c={},d=e,u="plugplay_paho_"+Math.random().toString(16).substr(2,8),p="mqtt.plugplay.co",l=8084;i=d.board_id+"/"+d.topic,r.send=function(e){if(a.isConnected()){switch(typeof e){case"boolean":e=e?"1":"0";break;case"number":e=String(e);break;case"object":e=JSON.stringify(e);break;case"string":}var n=new Paho.MQTT.Message(e);n.destinationName=i,a.send(n)}},r.onSettingsChanged=function(e){c={},d=e,i=d.board_id+"/"+d.topic,a.isConnected()&&a.disconnect(),a=new Paho.MQTT.Client(p,l,u),a.onConnectionLost=s,a.onMessageArrived=t,a.connect({onSuccess:o,userName:d.user_key,password:d.board_id,useSSL:d.use_ssl}),r.updateNow()},r.updateNow=function(){c.msg={device:"",data0:"",data1:"",data2:""},n(c)},r.onDispose=function(){a.isConnected()&&a.disconnect(),a={}},a=new Paho.MQTT.Client(p,l,u),a.onConnectionLost=s,a.onMessageArrived=t,a.connect({onSuccess:o,userName:d.user_key,password:d.board_id,useSSL:d.use_ssl})}}();