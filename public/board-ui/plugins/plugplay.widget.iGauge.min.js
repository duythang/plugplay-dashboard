!function(){freeboard.loadWidgetPlugin({type_name:"interactive_gauge",display_name:"Gauge",description:"Gauge with the ability to send a value as well as recieve one",external_scripts:["/board-ui/plugins/thirdparty/raphael.2.1.0.min.js","/board-ui/plugins/thirdparty/justgage.1.0.1.js"],settings:[{name:"title",display_name:"Title",type:"text",required:!0},{name:"value",display_name:"Value",type:"calculated"},{name:"callback",display_name:"Datasource to publish",type:"calculated"},{name:"click_value",display_name:"Set Value on Click",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"text",default_value:0},{name:"max_value",display_name:"Maximum",type:"text",default_value:100}],newInstance:function(e,a){a(new t(e))}});var e=0,t=function(t){function a(){r&&(s.empty(),n=new JustGage({id:l,value:_.isUndefined(h.min_value)?0:h.min_value,min:_.isUndefined(h.min_value)?0:h.min_value,max:_.isUndefined(h.max_value)?0:h.max_value,label:h.units,showInnerShadow:!1,valueFontColor:"#d3d4d4"}))}function i(e,t){var a=$("path",s)[0],i=a.getBBox(),n=e-i.x,l=t-i.y,u=i.width/2,r=i.height,d=r-l,o=n-u,c=180-Math.atan2(d,o)*(180/Math.PI);return c/180*(h.max_value-h.min_value)+h.min_value}var n,l="igauge-"+e++,u=$('<h2 class="section-title"></h2>'),s=$('<div class="gauge-widget" id="'+l+'"></div>'),r=!1,d=0,o=!1,h=t;this.onHover=function(e){if(o){var t=i(e.offsetX,e.offsetY);n.refresh(t.toFixed(1))}},this.mouseOver=function(){o=!0;var e=$("path",s)[0];e.setAttribute("filter","url(#glow)"),$("text",s)[0].setAttribute("fill","rgb(255,255,255)")},this.mouseOut=function(){o=!1,n.refresh(d);var e=$("path",s)[0];e.setAttribute("filter",null),$("text",s)[0].setAttribute("fill","rgb(211,212,212)")},this.onClick=function(e){if(e.preventDefault(),h.click_value){var t=i(e.offsetX,e.offsetY).toFixed(1);d=t,n.refresh(t),this.mouseOut();var a={device:h.title,data0:Number(t),data1:"",data2:""};this.sendValue(h.callback,a)}},this.render=function(e){r=!0,$(e).append(u).append($('<div class="gauge-widget-wrapper"></div>').append(s)),a(),$("path",s).click(this.onClick.bind(this)),$("path",s).bind("mousemove",_.debounce(this.onHover.bind(this),10)),$("path",s).bind("mouseover",this.mouseOver.bind(this)),$("path",s).bind("mouseout",this.mouseOut.bind(this)),$("path",s).css("cursor","pointer"),this.addFilter()},this.addFilter=function(){var e=$("defs",s)[0],t=document.createElementNS("http://www.w3.org/2000/svg","filter");t.setAttribute("id","glow");var a=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");a.setAttribute("stdDeviation","2.5"),a.setAttribute("result","coloredBlur"),t.appendChild(a);var i=document.createElementNS("http://www.w3.org/2000/svg","feMerge");t.appendChild(i);var n=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");n.setAttribute("in","coloredBlur"),i.appendChild(n);var l=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");l.setAttribute("in","SourceGraphic"),i.appendChild(l),e.appendChild(t)},this.onSettingsChanged=function(e){e.min_value!=h.min_value||e.max_value!=h.max_value||e.units!=h.units?(h=e,a()):h=e,u.html(e.title)},this.onCalculatedValueChanged=function(e,t){"value"==e&&(_.isUndefined(n)||(o||n.refresh(t),d=t))},this.onDispose=function(){},this.getHeight=function(){return 3},this.onSettingsChanged(t)}}();